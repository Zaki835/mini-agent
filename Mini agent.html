<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mini Agent Browser</title>
  <style>
    body {
      margin: 0;
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    #navbar {
      display: flex;
      align-items: center;
      padding: 8px;
      background-color: #f0f0f0;
      gap: 5px;
      position: relative;
    }

    input[type="text"], input[type="file"], input[type="password"] {
      flex: 1;
      padding: 6px;
      font-size: 14px;
    }

    button {
      padding: 6px 10px;
      font-size: 14px;
      cursor: pointer;
    }

    #myAiBtn {
      background: linear-gradient(to right, #3f51b5, #2196f3);
      color: white;
      border: none;
      border-radius: 4px;
    }

    #dropdown {
      position: absolute;
      top: 45px;
      right: 5px;
      background: white;
      border: 1px solid #ccc;
      display: none;
      flex-direction: column;
      min-width: 150px;
      z-index: 10;
    }

    #dropdown button {
      padding: 10px;
      text-align: left;
      border: none;
      background: none;
    }

    #dropdown button:hover {
      background-color: #f0f0f0;
    }

    #tabs {
      display: flex;
      overflow-x: auto;
      background: #e0e0e0;
      padding: 5px;
    }

    .tab {
      display: flex;
      align-items: center;
      background: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      margin-right: 5px;
      padding: 4px 8px;
      cursor: pointer;
    }

    .tab.active {
      background-color: #007bff;
      color: white;
    }

    .tab .close {
      margin-left: 8px;
      color: red;
      cursor: pointer;
    }

    iframe {
      flex: 1;
      border: none;
      width: 100%;
    }

    #aiModal {
      display: none;
      position: fixed;
      top: 20%;
      left: 50%;
      transform: translate(-50%, -20%);
      background: white;
      border: 1px solid #ccc;
      padding: 20px;
      z-index: 100;
      box-shadow: 0 0 10px rgba(0,0,0,0.3);
      border-radius: 8px;
      width: 300px;
    }

    #aiModal input, #aiModal button {
      margin-top: 10px;
      width: 100%;
      padding: 8px;
    }

    #aiModal textarea {
      margin-top: 10px;
      width: 100%;
      height: 150px;
      padding: 8px;
      font-size: 14px;
    }

    #bottomBar {
      display: flex;
      justify-content: space-around;
      padding: 8px;
      background-color: #f0f0f0;
    }

    .api-wrapper {
      position: relative;
    }
    .eye-toggle {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div id="navbar">
    <button id="myAiBtn" onclick="openAIModal()">▶️ My AI</button>
    <input type="text" id="urlInput" placeholder="Enter URL like https://example.com" />
    <button onclick="goToURL()">Go</button>
    <button onclick="toggleDropdown()">⋮</button>
    <div id="dropdown">
      <button onclick="openNewTab()">🆕 New Tab</button>
      <button onclick="reloadPage()">🔄 Reload</button>
      <button onclick="toggleDarkMode()">🌙 وضع ليلي</button>
      <button onclick="location.href='history.html'">📜 History</button>
      <button onclick="location.href='downloads.html'">⬇️ Downloads</button>
      <button onclick="location.href='passwords.html'">🔐 Password Save</button>
    </div>
  </div>

  <div id="tabs"></div>
  <iframe id="browserFrame" src="https://example.com"></iframe>

  <div id="bottomBar">
    <button onclick="goBack()">⬅️</button>
    <button onclick="goForward()">➡️</button>
    <button onclick="goHome()">🏠</button>
  </div>

  <div id="aiModal">
    <div class="api-wrapper">
      <input type="password" id="apiKeyInput" placeholder="API Key" />
      <span class="eye-toggle" onclick="toggleApiVisibility()">👁️‍🗨️</span>
    </div>
    <button onclick="saveApiKey()">💾 Save</button>
    <textarea id="taskInput" placeholder="Enter your task"></textarea>
    <input type="file" id="fileUpload" />
    <button onclick="runTask()" id="runTaskBtn">Run Task</button>
    <button onclick="closeAIModal()">❌ Cancel</button>
  </div>

  <script>
    let tabs = [];
    let currentTab = null;
    let isDarkMode = false;
    let apiKeyVisible = false;

    function openNewTab(url = "https://example.com") {
      const id = "tab" + Date.now();
      const tab = { id, url };
      tabs.push(tab);
      const el = document.createElement("div");
      el.className = "tab";
      el.id = id;
      el.innerHTML = `Tab ${tabs.length} <span class='close' onclick="closeTab(event, '${id}')">❌</span>`;
      el.onclick = () => switchTab(id);
      document.getElementById("tabs").appendChild(el);
      switchTab(id);
    }

    function closeTab(e, id) {
      e.stopPropagation();
      tabs = tabs.filter(t => t.id !== id);
      document.getElementById(id).remove();
      if (currentTab?.id === id) {
        if (tabs.length) switchTab(tabs[0].id);
        else {
          currentTab = null;
          document.getElementById("browserFrame").src = "about:blank";
        }
      }
    }

    function switchTab(id) {
      currentTab = tabs.find(t => t.id === id);
      document.querySelectorAll(".tab").forEach(t => t.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      updateBrowser(currentTab.url);
    }

    function goToURL() {
      const input = document.getElementById("urlInput").value.trim();
      if (!currentTab || !input) return;
      let url = input;
      if (!/^https?:\/\//.test(url)) url = "https://" + url;
      currentTab.url = url;
      updateBrowser(url);
    }

    function updateBrowser(url) {
      const iframe = document.getElementById("browserFrame");
      iframe.src = url;
      document.getElementById("urlInput").value = url;
    }

    function reloadPage() {
      if (currentTab) updateBrowser(currentTab.url);
    }

    function toggleDropdown() {
      const dropdown = document.getElementById("dropdown");
      dropdown.style.display = dropdown.style.display === "flex" ? "none" : "flex";
    }

    function toggleDarkMode() {
      isDarkMode = !isDarkMode;
      document.body.style.backgroundColor = isDarkMode ? "#222" : "white";
      document.body.style.color = isDarkMode ? "white" : "black";
    }

    function goBack() {
      document.getElementById("browserFrame").contentWindow.history.back();
    }

    function goForward() {
      document.getElementById("browserFrame").contentWindow.history.forward();
    }

    function goHome() {
      updateBrowser("https://example.com");
    }

    function openAIModal() {
      document.getElementById("aiModal").style.display = "block";
    }

    function closeAIModal() {
      document.getElementById("aiModal").style.display = "none";
      document.getElementById("myAiBtn").textContent = "▶️ My AI";
    }

    function toggleApiVisibility() {
      const input = document.getElementById("apiKeyInput");
      apiKeyVisible = !apiKeyVisible;
      input.type = apiKeyVisible ? "text" : "password";
    }

    function saveApiKey() {
      alert("API Key saved locally (simulation)");
    }

    function runTask() {
      const apiKey = document.getElementById("apiKeyInput").value.trim();
      const task = document.getElementById("taskInput").value.trim();
      const file = document.getElementById("fileUpload").files[0];
      if (!apiKey || !task) {
        alert("Please enter API key and task.");
        return;
      }

      const aiBtn = document.getElementById("myAiBtn");
      aiBtn.textContent = "⏸ My AI";
      const runBtn = document.getElementById("runTaskBtn");
      runBtn.textContent = "⏳ Running...";
      runBtn.disabled = true;

      setTimeout(() => {
        alert("Task complete! (Simulation)");
        runBtn.textContent = "Run Task";
        runBtn.disabled = false;
        closeAIModal();
      }, 3000);
    }

    openNewTab();
  </script>
</body>
</html>
